<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
		<link rel="stylesheet" href="main.css">
		<style>
			* {
				font-family: 'Roboto';
			}
			.restaurant{
				border: 2px solid red;
			}
			.table{
				padding: 5px;
				margin: 5px;
				border: 2px solid blue;
			}
			.field{
				height: 30px;
				border: 1px solid gray;
				width: 700px;
			}
		</style>
		<title>
			Restaurant Manager
		</title>
	</head>
	<body>
		<h1>Restaurant Manager</h1>
		<div id="app">
			<h2>Table Overview</h2>
			<div class="restaurant">
				<div v-for="table in tables" class="table">
					<div v-if="!table.available">
						Occupied by {{ table.people }}
						<br>
						(free in {{ TimeOut(table.duration) }})
						<br>
						<button type="button" name="button" @click="Evict(table.id - 1)">Evict</button>
					</div>
					<div v-else>
						Table Available
						<br>
						(capacity = {{ table.capacity }})
					</div>
				</div>
			</div>
			<br>
			<h3>New Party</h3>
			<p>Fill the following form to allocate a table to a party that is waiting to be seated.</p>
			<form method="POST">
				<p>
					<input class="field" type="number" name="people" v-model="party.people" placeholder="Number of People (non-zero positive integer)" min="1" required>
				</p>
				<p>
					<input class="field" type="number" name="duration" v-model="party.duration" placeholder="Duration of stay in seconds (positive number)" min="1" required>
				</p>
				<p>
					<input class="field" type="text" name="message" v-model="party.message" placeholder="Fuss message if evicted (text)" required>
				</p>
				<p>
					<button type="button" name="button" @click.prevent="NewParty">Add</button>
				</p>
			</form>
		</div>
		<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
		<script>
			const app = new Vue({
				el: '#app',
				data: {
					tables: [
						{id: 1, capacity: 10, available: true, people: 0, duration: 0, message: ''},
						{id: 2, capacity: 8, available: true, people: 0, duration: 0, message: ''},
						{id: 3, capacity: 10, available: true, people: 0, duration: 0, message: ''},
						{id: 4, capacity: 6, available: true, people: 0, duration: 0, message: ''},
						{id: 5, capacity: 2, available: true, people: 0, duration: 0, message: ''},
						{id: 6, capacity: 6, available: true, people: 0, duration: 0, message: ''},
						{id: 7, capacity: 4, available: true, people: 0, duration: 0, message: ''},
						{id: 8, capacity: 12, available: true, people: 0, duration: 0, message: ''},
					],
					party: {
						people: '',
						duration: '',
						message: '',
					},
				},
				methods: {
					async NewParty() {
						selection = ''
						for (var i = 0; i < this.tables.length; i++){
	            table = this.tables[i]
							if (table.available){
								if (this.party.people <= table.capacity && selection == ''){
									selection = i
								} else if (this.party.people <= table.capacity && table.capacity <= this.tables[selection].capacity && selection != '') {
									selection = i
								} else if (i == this.tables.length - 1 && selection == ''){
									this.party.people = ''
									this.party.duration = ''
									this.party.message = ''
									return alert("Can't find a table!!")
								}
							}
	          }
						this.tables[selection].available = false
						this.tables[selection].people = this.party.people
						this.tables[selection].duration = this.party.duration
						this.tables[selection].message = this.party.message
						this.party.people = ''
						this.party.duration = ''
						this.party.message = ''
						console.log(this.tables[selection].message)
						await this.awaitTable(this.tables[selection])
					},
					Evict(index, clicked=true){
						message = this.tables[index].message;
						console.log(message)
						this.tables[index].available = true
						this.tables[index].people = ''
						this.tables[index].duration = ''
						this.tables[index].message = ''
						if (clicked){
							return alert(message)
						}
					},
					awaitTable(table){
						return new Promise(resolve => {
					    setTimeout(() => {
					      resolve(this.Evict(table.id, false));
					    }, table.duration * 1000);
							});
					},
					TimeOut(secs){
						var minutes = Math.floor(secs/60)
						var seconds = secs % 60
						return minutes + ":" + seconds
					},
				},
				delimiters: ['{{', '}}'],
			});
		</script>
	</body>
</html>
